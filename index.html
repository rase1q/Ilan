<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chat Sandbox ‚Äî —Ç–µ—Å—Ç –æ–Ω–ª–∞–π–Ω-—á–∞—Ç–æ–≤</title>
  <style>
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#f6f7fb; color:#111; }
    header { position: sticky; top: 0; z-index: 10; background: #fff; border-bottom: 1px solid #e6e8ef; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 16px; }
    h1 { font-size: 18px; margin: 0; }
    .sub { font-size: 13px; color:#555; margin-top: 4px; }

    .grid { display:grid; grid-template-columns: 360px 1fr; gap: 16px; padding: 16px; max-width: 1100px; margin: 0 auto; }
    @media (max-width: 980px){ .grid{ grid-template-columns: 1fr; } }

    .card { background:#fff; border:1px solid #e6e8ef; border-radius: 12px; padding: 14px; box-shadow: 0 2px 10px rgba(0,0,0,.04); }
    .row { display:flex; gap: 8px; flex-wrap: wrap; align-items:center; }
    label { font-size: 12px; color:#666; display:block; margin: 8px 0 6px; }
    input, select, textarea, button {
      font: inherit; border-radius: 10px; border: 1px solid #d7dbe7; background:#fff;
      padding: 10px 12px;
    }
    input, select { width: 100%; }
    textarea { width: 100%; min-height: 220px; resize: vertical; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; }
    button { cursor: pointer; }
    .btn { background:#111; color:#fff; border: 1px solid #111; }
    .btn:disabled { opacity:.5; cursor:not-allowed; }
    .btn2 { background:#fff; }
    .danger { border-color:#ffb4b4; color:#8b0000; }
    .pill { font-size: 12px; padding: 6px 10px; border-radius: 999px; background:#eef2ff; color:#334; border:1px solid #dde3ff; }
    .status { font-size: 12px; color:#444; }
    .muted { color:#666; font-size: 12px; line-height: 1.4; }
    .log { margin-top: 10px; background:#0b1020; color:#e9ecff; border-radius: 12px; padding: 10px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; white-space: pre-wrap; }
    .hint { font-size: 12px; color:#333; background:#fff7e6; border:1px solid #ffe2a8; padding: 10px; border-radius: 12px; }
    .small { font-size: 12px; }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Chat Sandbox ‚Äî —Ç–µ—Å—Ç –æ–Ω–ª–∞–π–Ω-—á–∞—Ç–æ–≤ –Ω–∞ GitHub Pages</h1>
      <div class="sub">–î–æ–±–∞–≤–ª—è–π —Ä–∞–∑–Ω—ã–µ –≤–∏–¥–∂–µ—Ç—ã, –≤–∫–ª—é—á–∞–π/–≤—ã–∫–ª—é—á–∞–π, —Å–æ—Ö—Ä–∞–Ω—è–π –Ω–∞–±–æ—Ä—ã. –í—Å—ë —Ö—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.</div>
    </div>
  </header>

  <div class="grid">
    <!-- LEFT -->
    <section class="card">
      <div class="row" style="justify-content:space-between">
        <div class="pill" id="activePill">–ê–∫—Ç–∏–≤–Ω—ã–π: ‚Äî</div>
        <div class="status" id="activeStatus">–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ</div>
      </div>

      <label>–í—ã–±–µ—Ä–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —á–∞—Ç</label>
      <select id="presetSelect"></select>

      <div class="row" style="margin-top:10px">
        <button class="btn2" id="newBtn">‚ûï –ù–æ–≤—ã–π</button>
        <button class="btn2 danger" id="deleteBtn">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
      </div>

      <label style="margin-top:14px">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
      <input id="nameInput" placeholder="–ù–∞–ø—Ä. amoCRM, Jivo, LiveChat, Chatra‚Ä¶" />

      <label>–ö–æ–¥ –≤–∏–¥–∂–µ—Ç–∞ (–≤—Å—Ç–∞–≤–ª—è–π —Å—é–¥–∞ <script>‚Ä¶</script> –∫–∞–∫ –¥–∞–ª–∏)</label>
      <textarea id="codeInput" placeholder="–í—Å—Ç–∞–≤—å —Å—é–¥–∞ –∫–æ–¥ –≤–∏–¥–∂–µ—Ç–∞ –æ–Ω–ª–∞–π–Ω-—á–∞—Ç–∞"></textarea>

      <div class="row" style="margin-top:10px">
        <button class="btn" id="saveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="btn" id="enableBtn">‚úÖ –í–∫–ª—é—á–∏—Ç—å</button>
        <button class="btn2" id="disableBtn">‚õî –í—ã–∫–ª—é—á–∏—Ç—å</button>
      </div>

      <div class="hint" style="margin-top:12px">
        <div class="small"><b>–ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:</b></div>
        <div class="small">1) –í—Å—Ç–∞–≤–∏–ª –∫–æ–¥ ‚Üí <b>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</b> ‚Üí <b>–í–∫–ª—é—á–∏—Ç—å</b></div>
        <div class="small">2) –ß—Ç–æ–±—ã –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ –¥—Ä—É–≥–æ–π —á–∞—Ç: <b>–í—ã–∫–ª—é—á–∏—Ç—å</b> ‚Üí –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π ‚Üí <b>–í–∫–ª—é—á–∏—Ç—å</b></div>
      </div>

      <div class="log" id="logBox">–õ–æ–≥‚Ä¶</div>
    </section>

    <!-- RIGHT -->
    <section class="card">
      <h2 style="margin:0 0 8px; font-size:16px;">–ü–µ—Å–æ—á–Ω–∏—Ü–∞ (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è —Ç–µ—Å—Ç–∞)</h2>
      <div class="muted">
        –¢—É—Ç –æ–±—ã—á–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç. –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≤–∏–¥–∂–µ—Ç–æ–≤ —á–∞—Ç–∞ –ø–æ—è–≤–∏—Ç—Å—è –≤ —É–≥–ª—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
        –ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è ‚Äî —Å–º–æ—Ç—Ä–∏ –ª–æ–≥ —Å–ª–µ–≤–∞ –∏ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12 ‚Üí Console).
      </div>

      <div style="margin-top:14px; display:grid; gap:12px;">
        <div class="card" style="border-radius: 14px;">
          <b>–¢–µ—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏</b>
          <div class="muted">–ú–æ–∂–Ω–æ –∫–ª–∏–∫–∞—Ç—å, —Å–∫—Ä–æ–ª–ª–∏—Ç—å ‚Äî –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –Ω–µ –ª–æ–º–∞–µ—Ç –ª–∏ —á–∞—Ç UI.</div>
        </div>

        <div class="card" style="border-radius: 14px;">
          <b>–§–æ—Ä–º–∞</b>
          <div class="muted">–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —á–∞—Ç—ã —Ü–µ–ø–ª—è—é—Ç—Å—è –∫ —Ñ–æ—Ä–º–∞–º/–∫–Ω–æ–ø–∫–∞–º.</div>
          <div class="row" style="margin-top:10px">
            <input placeholder="–ò–º—è" style="flex:1; min-width: 220px;">
            <input placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" style="flex:1; min-width: 220px;">
          </div>
          <div class="row" style="margin-top:10px">
            <button class="btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            <button class="btn2">–û—Ç–º–µ–Ω–∞</button>
          </div>
        </div>

        <div class="card" style="border-radius: 14px;">
          <b>–ó–∞–º–µ—Ç–∫–∞</b>
          <div class="muted">–ï—Å–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä —Ç—Ä–µ–±—É–µ—Ç whitelist –¥–æ–º–µ–Ω–∞ ‚Äî –¥–æ–±–∞–≤—å –¥–æ–º–µ–Ω GitHub Pages –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–∏–¥–∂–µ—Ç–∞.</div>
        </div>
      </div>
    </section>
  </div>

  <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∏–Ω—ä–µ–∫—Ü–∏–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
  <div id="chat-mount" aria-hidden="true"></div>

  <script>
    // ===== Storage =====
    const KEY_PRESETS = "chatSandbox.presets.v1";
    const KEY_ACTIVE = "chatSandbox.activeId.v1";

    const $ = (id) => document.getElementById(id);

    const presetSelect = $("presetSelect");
    const nameInput = $("nameInput");
    const codeInput = $("codeInput");
    const logBox = $("logBox");
    const activePill = $("activePill");
    const activeStatus = $("activeStatus");

    const mount = $("chat-mount");

    function log(msg) {
      const t = new Date().toLocaleTimeString();
      logBox.textContent = `[${t}] ${msg}\n` + logBox.textContent;
    }

    function loadPresets() {
      try {
        const raw = localStorage.getItem(KEY_PRESETS);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch {
        return [];
      }
    }

    function savePresets(list) {
      localStorage.setItem(KEY_PRESETS, JSON.stringify(list));
    }

    function getActiveId() {
      return localStorage.getItem(KEY_ACTIVE) || "";
    }
    function setActiveId(id) {
      localStorage.setItem(KEY_ACTIVE, id);
    }

    function uid() {
      return Math.random().toString(16).slice(2) + Date.now().toString(16);
    }

    // ===== UI =====
    function renderSelect(presets) {
      const activeId = getActiveId();
      presetSelect.innerHTML = "";

      if (presets.length === 0) {
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = "–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö ‚Äî –Ω–∞–∂–º–∏ ¬´–ù–æ–≤—ã–π¬ª";
        presetSelect.appendChild(opt);
        presetSelect.disabled = true;
        return;
      }

      presetSelect.disabled = false;

      for (const p of presets) {
        const opt = document.createElement("option");
        opt.value = p.id;
        opt.textContent = p.name || "(–±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è)";
        presetSelect.appendChild(opt);
      }

      // –≤—ã–±—Ä–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∏–ª–∏ –ø–µ—Ä–≤—ã–π
      const exists = presets.some(p => p.id === activeId);
      presetSelect.value = exists ? activeId : presets[0].id;
    }

    function currentPreset(presets) {
      const id = presetSelect.value;
      return presets.find(p => p.id === id) || null;
    }

    function fillEditor(p) {
      nameInput.value = p?.name || "";
      codeInput.value = p?.code || "";
      activePill.textContent = `–ê–∫—Ç–∏–≤–Ω—ã–π: ${p?.name ? p.name : "‚Äî"}`;
    }

    // ===== Chat injection =====
    function clearMount() {
      // —É–¥–∞–ª—è–µ–º –≤—Å—ë, —á—Ç–æ —Ä–∞–Ω–µ–µ –¥–æ–±–∞–≤–∏–ª–∏
      mount.innerHTML = "";
      // –∏–Ω–æ–≥–¥–∞ –≤–∏–¥–∂–µ—Ç—ã –ª–µ–ø—è—Ç —Å–≤–æ–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ body ‚Äî —ç—Ç–æ —É–∂–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞,
      // –Ω–æ —Ö–æ—Ç—è –±—ã –Ω–∞—à–∏ —Å–∫—Ä–∏–ø—Ç—ã –º—ã —É–±–µ—Ä—ë–º.
      log("–û—á–∏—â–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (—Å–∫—Ä–∏–ø—Ç—ã, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–µ—Å–æ—á–Ω–∏—Ü–µ–π).");
    }

    function enableChatFromCode(code) {
      clearMount();
      if (!code || !code.trim()) {
        activeStatus.textContent = "–ù–µ—Ç –∫–æ–¥–∞";
        log("–ù–µ–ª—å–∑—è –≤–∫–ª—é—á–∏—Ç—å: –∫–æ–¥ –ø—É—Å—Ç–æ–π.");
        return;
      }

      // –≤—Å—Ç–∞–≤–ª—è–µ–º HTML —Å–æ <script> ‚Äî –±—Ä–∞—É–∑–µ—Ä –∏—Ö –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç —á–µ—Ä–µ–∑ innerHTML
      // –ø–æ—ç—Ç–æ–º—É: 1) –ø–∞—Ä—Å–∏–º, 2) –≤—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞—ë–º script-—Ç–µ–≥–∏.
      const temp = document.createElement("div");
      temp.innerHTML = code;

      const scripts = Array.from(temp.querySelectorAll("script"));
      if (scripts.length === 0) {
        activeStatus.textContent = "–ö–æ–¥ –±–µ–∑ <script>";
        log("–í –∫–æ–¥–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ <script>. –í—Å—Ç–∞–≤—å –∏–º–µ–Ω–Ω–æ –∫–æ–¥ –≤–∏–¥–∂–µ—Ç–∞.");
        return;
      }

      // –î–æ–±–∞–≤–∏–º –∏ –≤—ã–ø–æ–ª–Ω–µ–º –ø–æ –æ—á–µ—Ä–µ–¥–∏
      for (const old of scripts) {
        const s = document.createElement("script");
        // –ø–µ—Ä–µ–Ω–æ—Å–∏–º –∞—Ç—Ä–∏–±—É—Ç—ã
        for (const attr of old.attributes) s.setAttribute(attr.name, attr.value);

        if (old.src) {
          s.src = old.src;
          s.async = old.async || true;
        } else {
          s.text = old.textContent || "";
        }
        mount.appendChild(s);
      }

      activeStatus.textContent = "–ó–∞–≥—Ä—É–∂–µ–Ω–æ (–ø—Ä–æ–≤–µ—Ä—å —É–≥–æ–ª —Å—Ç—Ä–∞–Ω–∏—Ü—ã)";
      log(`–í–∫–ª—é—á–µ–Ω–æ: –≤—ã–ø–æ–ª–Ω–µ–Ω–æ <script> (${scripts.length} —à—Ç.)`);
    }

    // ===== Events =====
    function init() {
      let presets = loadPresets();
      renderSelect(presets);

      const p = currentPreset(presets);
      fillEditor(p);

      // auto: –µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π ‚Äî –Ω–µ –≤–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª–æ),
      // –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, –∫–∞–∫–æ–π –≤—ã–±—Ä–∞–Ω.
      if (p) activePill.textContent = `–ê–∫—Ç–∏–≤–Ω—ã–π: ${p.name || "‚Äî"}`;
      activeStatus.textContent = "–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ";
      log("–ì–æ—Ç–æ–≤–æ. –í—Å—Ç–∞–≤—å –∫–æ–¥ ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ‚Üí –í–∫–ª—é—á–∏—Ç—å.");
    }

    $("newBtn").addEventListener("click", () => {
      const presets = loadPresets();
      const id = uid();
      const p = { id, name: "New chat", code: "" };
      presets.unshift(p);
      savePresets(presets);
      setActiveId(id);
      renderSelect(presets);
      fillEditor(p);
      log("–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –ø—Ä–µ—Å–µ—Ç.");
    });

    $("deleteBtn").addEventListener("click", () => {
      const presets = loadPresets();
      const cur = currentPreset(presets);
      if (!cur) return;

      const next = presets.filter(x => x.id !== cur.id);
      savePresets(next);

      if (getActiveId() === cur.id) setActiveId(next[0]?.id || "");
      renderSelect(next);
      fillEditor(currentPreset(next));
      clearMount();
      activeStatus.textContent = "–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ";
      log(`–£–¥–∞–ª—ë–Ω –ø—Ä–µ—Å–µ—Ç: ${cur.name || cur.id}`);
    });

    presetSelect.addEventListener("change", () => {
      const presets = loadPresets();
      const p = currentPreset(presets);
      setActiveId(p?.id || "");
      fillEditor(p);
      activeStatus.textContent = "–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ";
      clearMount();
      log("–í—ã–±—Ä–∞–Ω –¥—Ä—É–≥–æ–π –ø—Ä–µ—Å–µ—Ç. –ù–∞–∂–º–∏ ¬´–í–∫–ª—é—á–∏—Ç—å¬ª –¥–ª—è —Ç–µ—Å—Ç–∞.");
    });

    $("saveBtn").addEventListener("click", () => {
      const presets = loadPresets();
      const p = currentPreset(presets);
      if (!p) {
        log("–ù–µ—Ç –ø—Ä–µ—Å–µ—Ç–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è. –ù–∞–∂–º–∏ ¬´–ù–æ–≤—ã–π¬ª.");
        return;
      }
      p.name = nameInput.value.trim() || "(–±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è)";
      p.code = codeInput.value;

      savePresets(presets);
      renderSelect(presets);
      presetSelect.value = p.id;
      fillEditor(p);
      log("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ.");
    });

    $("enableBtn").addEventListener("click", () => {
      const presets = loadPresets();
      const p = currentPreset(presets);
      if (!p) {
        log("–ù–µ—Ç –ø—Ä–µ—Å–µ—Ç–∞. –ù–∞–∂–º–∏ ¬´–ù–æ–≤—ã–π¬ª.");
        return;
      }
      setActiveId(p.id);
      activePill.textContent = `–ê–∫—Ç–∏–≤–Ω—ã–π: ${p.name || "‚Äî"}`;

      // –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç: –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ–¥—ã —Å–æ–¥–µ—Ä–∂–∞—Ç hidden=true, —Ç–æ–≥–¥–∞ –∫–Ω–æ–ø–∫–∏ –Ω–µ –±—É–¥–µ—Ç
      enableChatFromCode(p.code);
    });

    $("disableBtn").addEventListener("click", () => {
      clearMount();
      activeStatus.textContent = "–û—Ç–∫–ª—é—á–µ–Ω–æ";
      log("–û—Ç–∫–ª—é—á–µ–Ω–æ.");
    });

    init();
  </script>
</body>
</html>
